<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trader Brothers - Consultation Outcome</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .logo .gold-a {
            color: #bc9c22;
        }

        .tagline {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 10px;
            font-size: 2rem;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section.hidden {
            display: none;
        }

        .section-title {
            color: #2d2d2d;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #bc9c22;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d2d2d;
            font-size: 0.95rem;
        }

        label .required {
            color: #bc9c22;
            margin-left: 3px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="date"] {
            cursor: pointer;
            position: relative;
            color: #2d2d2d;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23bc9c22" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            transition: all 0.3s ease;
            background-color: rgba(188, 156, 34, 0.1);
        }

        input[type="date"]::-webkit-calendar-picker-indicator:hover {
            background-color: rgba(188, 156, 34, 0.2);
            transform: scale(1.05);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #bc9c22;
            box-shadow: 0 0 10px rgba(188, 156, 34, 0.2);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23bc9c22" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 45px;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }

        .info-box {
            background: linear-gradient(135deg, #fefcf0 0%, #faf6e8 100%);
            border-left: 4px solid #bc9c22;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            font-size: 0.9rem;
            color: #666;
        }

        .btn-container {
            text-align: center;
            margin-top: 35px;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: linear-gradient(135deg, #bc9c22, #d4af37);
            color: white;
            box-shadow: 0 10px 20px rgba(188, 156, 34, 0.3);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(188, 156, 34, 0.4);
        }

        .btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .back-btn {
            margin-top: 15px;
            padding: 12px 35px;
            background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 16px rgba(107, 114, 128, 0.3);
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(107, 114, 128, 0.4);
            filter: brightness(1.1);
        }

        .back-btn:active {
            transform: translateY(0);
        }

        .confirmation-screen {
            display: none;
        }

        .info-grid {
            background: linear-gradient(135deg, #f8f8f8 0%, #f0f0f0 100%);
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #bc9c22;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .info-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #1a1a1a;
            min-width: 180px;
            flex-shrink: 0;
        }

        .info-value {
            color: #3d3d3d;
            flex-grow: 1;
        }

        .thank-you-message {
            background: linear-gradient(135deg, #fefcf0 0%, #faf6e8 100%);
            border: 2px solid #bc9c22;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 25px;
        }

        .thank-you-message h3 {
            color: #8a7319;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .thank-you-message p {
            color: #6b5a16;
            margin: 0;
        }

        .review-title {
            color: #1a1a1a;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .thank-you-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .thank-you-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            margin: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .thank-you-card h2 {
            color: #1a1a1a;
            margin-bottom: 15px;
        }

        .thank-you-card p {
            color: #3d3d3d;
            margin-bottom: 25px;
        }

        .close-btn {
            padding: 12px 28px;
            background: linear-gradient(135deg, #bc9c22, #d4af37);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 16px rgba(188, 156, 34, 0.3);
        }

        .close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(188, 156, 34, 0.4);
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading .btn {
            background: #9ca3af;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header, .form-card {
                padding: 25px 20px;
            }

            .logo {
                font-size: 2rem;
            }

            h1 {
                font-size: 1.6rem;
            }

            .btn, .back-btn {
                width: 100%;
            }

            .info-item {
                flex-direction: column;
                gap: 5px;
            }

            .info-label {
                min-width: auto;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">TR<span class="gold-a">A</span>DER BROTHERS</div>
            <div class="tagline">Professional Joinery Services & Bespoke Craftsmanship</div>
        </div>

        <div class="form-card">
            <!-- Initial Form -->
            <div id="initialForm">
                <h1>Consultation Outcome</h1>
                <p class="subtitle">Complete the consultation details and outcome</p>

                <div class="info-box">
                    <strong>üìã Consultation Form:</strong> Fill in all client details and consultation outcome below, then review before final submission.
                </div>

                <form id="consultationForm">
                    <div class="form-section">
                        <h2 class="section-title">Client Information</h2>

                        <div class="form-group">
                            <label for="name">Full Name <span class="required">*</span></label>
                            <input type="text" id="name" name="name" required placeholder="e.g., John Smith">
                        </div>

                        <div class="form-group">
                            <label for="email">Email Address <span class="required">*</span></label>
                            <input type="email" id="email" name="email" required placeholder="e.g., john.smith@email.com">
                        </div>

                        <div class="form-group">
                            <label for="phone">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="phone" name="phone" required placeholder="e.g., 07123 456789">
                        </div>

                        <div class="form-group">
                            <label for="clientId">Client ID</label>
                            <input type="text" id="clientId" name="clientId" placeholder="Optional - if applicable">
                        </div>

                        <div class="form-group">
                            <label for="client_address">Client Address <span class="required">*</span></label>
                            <input type="text" id="client_address" name="client_address" required placeholder="e.g., 123 High Street, Edinburgh, EH1 1AA">
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Consultation Outcome</h2>

                        <div class="form-group">
                            <label for="outcome">Consultation Outcome <span class="required">*</span></label>
                            <select id="outcome" name="outcome" required>
                                <option value="" disabled selected>Select outcome...</option>
                                <option value="Closed Deal">Closed Deal</option>
                                <option value="Follow-up Needed">Follow-up Needed</option>
                                <option value="Not Interested">Not Interested</option>
                                <option value="No Response">No Response</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section hidden" id="projectStartSection">
                        <h2 class="section-title">Project Start Date</h2>

                        <div class="form-group">
                            <label for="start_date">Estimated Start Date <span class="required">*</span></label>
                            <div class="date-input-wrapper">
                                <input type="date" id="start_date" name="start_date">
                            </div>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 8px; font-style: italic;">
                                If unsure, please just pick an estimate but be sure to change the actual date inside of the project management.
                            </p>
                        </div>
                    </div>

                    <div class="form-section hidden" id="workDetailsSection">
                        <h2 class="section-title">Work Details</h2>

                        <div class="form-group">
                            <label for="project_type">Project Type <span class="required">*</span></label>
                            <select id="project_type" name="project_type">
                                <option value="" disabled selected>Select project type...</option>
                                <option value="Kitchen Installation">Kitchen Installation</option>
                                <option value="Bathroom Renovation">Bathroom Renovation</option>
                                <option value="Plastering">Plastering</option>
                                <option value="Flooring">Flooring</option>
                                <option value="Carpentry">Carpentry</option>
                                <option value="Decking">Decking</option>
                                <option value="Painting & Decorating">Painting & Decorating</option>
                                <option value="Electrical Work">Electrical Work</option>
                                <option value="Plumbing">Plumbing</option>
                                <option value="General Renovation">General Renovation</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="work_location">Where will the work be done? <span class="required">*</span></label>
                            <input type="text" id="work_location" name="work_location" placeholder="e.g., Kitchen, Master Bathroom, Entire Ground Floor">
                        </div>

                        <div class="form-group">
                            <label for="work_description">What needs to be done? <span class="required">*</span></label>
                            <textarea id="work_description" name="work_description" placeholder="e.g., Remove old kitchen units and install new ones, replaster walls and ceiling, install laminate flooring throughout" maxlength="300"></textarea>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">Maximum 300 characters</p>
                        </div>

                        <div class="form-group">
                            <label for="materials_responsibility">Materials & Supply Responsibility <span class="required">*</span></label>
                            <select id="materials_responsibility" name="materials_responsibility">
                                <option value="" disabled selected>Select an option...</option>
                                <option value="Trader Brothers Providing All Materials">Trader Brothers Providing All Materials</option>
                                <option value="Client Providing Some/All Materials">Client Providing Some/All Materials</option>
                            </select>
                        </div>

                        <div class="form-group" id="client_materials_group" style="display: none;">
                            <label for="client_materials_list">Which materials will the client provide? <span class="required">*</span></label>
                            <textarea id="client_materials_list" name="client_materials_list" placeholder="e.g., Light fixtures, tiles, paint colors, cabinet handles" maxlength="250" style="min-height: 80px;"></textarea>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">Maximum 250 characters</p>
                        </div>

                        <div class="form-group">
                            <label for="special_requirements">Any special requirements or concerns? (Optional)</label>
                            <input type="text" id="special_requirements" name="special_requirements" placeholder="e.g., Must match existing woodwork, eco-friendly materials preferred, work around pets" maxlength="150">
                            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">Maximum 150 characters</p>
                        </div>

                        <div class="form-group">
                            <label for="not_included">What's NOT Included (Optional)</label>
                            <textarea id="not_included" name="not_included" placeholder="e.g., Painting/decorating, disposal of old materials, repairs to adjacent areas, permits/inspections" maxlength="300" style="min-height: 80px;"></textarea>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">Maximum 300 characters</p>
                        </div>
                    </div>

                    <div class="btn-container">
                        <button type="submit" class="btn">Review Submission</button>
                    </div>
                </form>
            </div>

            <!-- Confirmation Screen -->
            <div id="confirmationScreen" class="confirmation-screen">
                <div class="thank-you-message">
                    <h3>Thank You!</h3>
                    <p>Please review your information below before final submission.</p>
                </div>

                <div class="review-title">Review Your Information</div>
                
                <div class="info-grid" id="reviewInfo">
                    <!-- Information will be populated here -->
                </div>

                <div class="btn-container">
                    <button type="button" class="btn" id="confirmBtn">Confirm & Submit</button>
                    <button type="button" class="back-btn" id="backBtn">‚Üê Back to Edit</button>
                </div>
            </div>
        </div>
    </div>

    <div class="thank-you-overlay" id="thankYouOverlay">
        <div class="thank-you-card">
            <h2>Success!</h2>
            <p>Your consultation outcome has been successfully submitted. We appreciate your time and will process this information accordingly.</p>
            <button class="close-btn" onclick="closeThankYou()">Close</button>
        </div>
    </div>

    <script>
        let formData = {};

        // Show/hide project sections based on outcome
        document.getElementById('outcome').addEventListener('change', function() {
            const projectStartSection = document.getElementById('projectStartSection');
            const workDetailsSection = document.getElementById('workDetailsSection');
            const startDateInput = document.getElementById('start_date');
            const projectTypeInput = document.getElementById('project_type');
            const workLocationInput = document.getElementById('work_location');
            const workDescriptionInput = document.getElementById('work_description');
            const materialsResponsibilityInput = document.getElementById('materials_responsibility');
            
            if (this.value === 'Closed Deal') {
                projectStartSection.classList.remove('hidden');
                workDetailsSection.classList.remove('hidden');
                startDateInput.required = true;
                projectTypeInput.required = true;
                workLocationInput.required = true;
                workDescriptionInput.required = true;
                materialsResponsibilityInput.required = true;
            } else {
                projectStartSection.classList.add('hidden');
                workDetailsSection.classList.add('hidden');
                startDateInput.required = false;
                projectTypeInput.required = false;
                workLocationInput.required = false;
                workDescriptionInput.required = false;
                materialsResponsibilityInput.required = false;
                
                // Clear the values when hidden
                startDateInput.value = '';
                projectTypeInput.value = '';
                workLocationInput.value = '';
                workDescriptionInput.value = '';
                materialsResponsibilityInput.value = '';
                document.getElementById('client_materials_list').value = '';
                document.getElementById('special_requirements').value = '';
                document.getElementById('not_included').value = '';
                document.getElementById('client_materials_group').style.display = 'none';
            }
        });

        // Show/hide client materials field based on materials responsibility selection
        document.getElementById('materials_responsibility').addEventListener('change', function() {
            const clientMaterialsGroup = document.getElementById('client_materials_group');
            const clientMaterialsList = document.getElementById('client_materials_list');
            
            if (this.value === 'Client Providing Some/All Materials') {
                clientMaterialsGroup.style.display = 'block';
                clientMaterialsList.required = true;
            } else {
                clientMaterialsGroup.style.display = 'none';
                clientMaterialsList.required = false;
                clientMaterialsList.value = '';
            }
        });

        function populateFieldsFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.get('name')) {
                document.getElementById('name').value = decodeURIComponent(urlParams.get('name'));
            }
            if (urlParams.get('email')) {
                document.getElementById('email').value = decodeURIComponent(urlParams.get('email'));
            }
            if (urlParams.get('phone')) {
                document.getElementById('phone').value = decodeURIComponent(urlParams.get('phone'));
            }
            if (urlParams.get('clientId')) {
                document.getElementById('clientId').value = decodeURIComponent(urlParams.get('clientId'));
            }
            if (urlParams.get('clientAddress')) {
                document.getElementById('client_address').value = decodeURIComponent(urlParams.get('clientAddress'));
            }
        }

        document.getElementById('consultationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Gather all form data
            formData = {
                name: document.getElementById('name').value || '',
                email: document.getElementById('email').value || '',
                phone: document.getElementById('phone').value || '',
                clientId: document.getElementById('clientId').value || '',
                clientAddress: document.getElementById('client_address').value || '',
                outcome: document.getElementById('outcome').value || '',
                startDate: document.getElementById('start_date').value || '',
                projectType: document.getElementById('project_type').value || '',
                workLocation: document.getElementById('work_location').value || '',
                workDescription: document.getElementById('work_description').value || '',
                materialsResponsibility: document.getElementById('materials_responsibility').value || '',
                clientMaterialsList: document.getElementById('client_materials_list').value || '',
                specialRequirements: document.getElementById('special_requirements').value || '',
                notIncluded: document.getElementById('not_included').value || ''
            };
            
            showConfirmationScreen();
        });

        function showConfirmationScreen() {
            document.getElementById('initialForm').style.display = 'none';
            document.getElementById('confirmationScreen').style.display = 'block';
            
            populateReviewInfo();
        }

        function populateReviewInfo() {
            const reviewContainer = document.getElementById('reviewInfo');
            const fields = [
                { key: 'name', label: 'Full Name' },
                { key: 'email', label: 'Email Address' },
                { key: 'phone', label: 'Phone Number' },
                { key: 'clientId', label: 'Client ID' },
                { key: 'clientAddress', label: 'Client Address' },
                { key: 'outcome', label: 'Consultation Outcome' },
                { key: 'startDate', label: 'Estimated Start Date' },
                { key: 'projectType', label: 'Project Type' },
                { key: 'workLocation', label: 'Work Location' },
                { key: 'workDescription', label: 'Work Description' },
                { key: 'materialsResponsibility', label: 'Materials Responsibility' },
                { key: 'clientMaterialsList', label: 'Client Materials List' },
                { key: 'specialRequirements', label: 'Special Requirements' },
                { key: 'notIncluded', label: 'Not Included' }
            ];

            reviewContainer.innerHTML = '';

            fields.forEach(field => {
                const value = formData[field.key];
                if (value) {
                    const infoItem = document.createElement('div');
                    infoItem.className = 'info-item';
                    infoItem.innerHTML = `
                        <div class="info-label">${field.label}:</div>
                        <div class="info-value">${value}</div>
                    `;
                    reviewContainer.appendChild(infoItem);
                }
            });
        }

        document.getElementById('backBtn').addEventListener('click', function() {
            document.getElementById('confirmationScreen').style.display = 'none';
            document.getElementById('initialForm').style.display = 'block';
        });

        document.getElementById('confirmBtn').addEventListener('click', async function() {
            const confirmBtn = this;
            const container = document.getElementById('confirmationScreen');
            
            container.classList.add('loading');
            confirmBtn.textContent = 'Submitting...';
            
            try {
                let submitData = {
                    ...formData,
                    submittedAt: new Date().toISOString()
                };
                
                // If Closed Deal, format the work details
                if (formData.outcome === 'Closed Deal') {
                    const formattedDetails = formatWorkDetails(formData);
                    submitData = {
                        ...submitData,
                        ...formattedDetails
                    };
                }
                
                console.log('Sending data to webhook:', submitData);
                
                // Send to Make.com webhook
                const response = await fetch('https://hook.eu2.make.com/85gyjmo134cis9xsykr8w6ms2ihg3unp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submitData)
                });
                
                if (response.ok) {
                    showFinalThankYou();
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                alert('There was an error submitting the form. Please try again.');
                console.error('Submission error:', error);
            } finally {
                container.classList.remove('loading');
                confirmBtn.textContent = 'Confirm & Submit';
            }
        });

        function formatWorkDetails(data) {
            const address = data.clientAddress || 'the specified address';
            
            // Format Work To Be Done
            let workToBeDone = `We agree to perform the following work at ${address}: ${data.workDescription} in ${data.workLocation}. Key tasks: `;
            
            // Generate key tasks based on project type
            const tasks = generateKeyTasks(data.projectType, data.workDescription);
            workToBeDone += tasks.map((task, index) => `${index + 1}. ${task}`).join(' ');
            
            // Add special requirements if provided
            if (data.specialRequirements) {
                workToBeDone += ` Note: ${data.specialRequirements}`;
            }
            
            // Format Materials and Supplies
            let materialsAndSupplies = '';
            if (data.materialsResponsibility === 'Trader Brothers Providing All Materials') {
                materialsAndSupplies = 'We will provide all necessary materials and supplies. Material costs will be itemized on your final invoice.';
            } else {
                const clientMaterials = data.clientMaterialsList ? data.clientMaterialsList.toLowerCase() : 'the materials you specified';
                materialsAndSupplies = `We will provide standard materials. You are responsible for: ${clientMaterials}. Ensure materials are on-site before work begins.`;
            }
            
            // Format Cleanup
            const cleanup = 'We will clean up debris daily and leave the area tidy upon completion.';
            
            // Format Exclusions
            let exclusions = 'This price does not cover:';
            if (data.notIncluded) {
                const exclusionItems = data.notIncluded.split(',').map(item => item.trim());
                exclusions += ' ' + exclusionItems.map(item => `- ${item}`).join(' ');
            } else {
                const defaultExclusions = getDefaultExclusions(data.projectType);
                exclusions += ' ' + defaultExclusions.map(item => `- ${item}`).join(' ');
            }
            
            // Format Changes
            const changes = 'Additional work requires a written Change Order with agreed pricing before starting.';
            
            return {
                workToBeDone,
                materialsAndSupplies,
                cleanup,
                exclusions,
                changes
            };
        }

        function generateKeyTasks(projectType, workDescription) {
            // Common task patterns based on project type
            const taskTemplates = {
                'Kitchen Installation': [
                    'Remove and dispose of existing cabinet units',
                    'Prepare wall and floor surfaces for new installation',
                    'Install new cabinet units and countertops',
                    'Fit handles and adjust doors',
                    'Inspect and ensure proper alignment of all fittings'
                ],
                'Bathroom Renovation': [
                    'Remove existing fixtures and fittings',
                    'Prepare surfaces for new installation',
                    'Install new bathroom fixtures',
                    'Seal and waterproof as necessary',
                    'Test all installations for proper operation'
                ],
                'Plastering': [
                    'Prepare surfaces and protect surrounding areas',
                    'Apply base coat and allow to dry',
                    'Apply finish coat for smooth surface',
                    'Sand and prepare for decoration',
                    'Clean work area upon completion'
                ],
                'Flooring': [
                    'Remove existing flooring material',
                    'Prepare and level subfloor',
                    'Install new flooring material',
                    'Fit trim and transitions',
                    'Clean and inspect completed installation'
                ],
                'Carpentry': [
                    'Measure and plan installation',
                    'Prepare work area and materials',
                    'Cut and fit components',
                    'Secure and finish all joints',
                    'Sand and prepare for final finish'
                ],
                'Decking': [
                    'Prepare ground and install base structure',
                    'Install deck boards and secure',
                    'Fit railings and safety features',
                    'Apply protective treatment',
                    'Inspect and ensure structural integrity'
                ],
                'Painting & Decorating': [
                    'Prepare surfaces and protect areas',
                    'Apply primer coat',
                    'Apply finish coats as required',
                    'Touch up and detail work',
                    'Clean work area and remove protection'
                ],
                'Electrical Work': [
                    'Assess existing electrical system',
                    'Install new circuits and fixtures',
                    'Connect and test all installations',
                    'Ensure compliance with regulations',
                    'Certify work upon completion'
                ],
                'Plumbing': [
                    'Assess existing plumbing system',
                    'Install new pipes and fixtures',
                    'Connect and seal all joints',
                    'Test for leaks and proper flow',
                    'Ensure compliance with regulations'
                ],
                'General Renovation': [
                    'Assess and plan renovation scope',
                    'Remove existing elements as needed',
                    'Install new components and fixtures',
                    'Finish and detail all work',
                    'Inspect and ensure quality standards'
                ]
            };
            
            // Check for door-related work
            if (workDescription.toLowerCase().includes('door')) {
                return [
                    'Remove existing doors and hardware',
                    'Prepare frames for new installations',
                    'Fit new doors with hinges and handles',
                    'Adjust alignment and ensure smooth operation',
                    'Test all fittings for proper closure'
                ];
            }
            
            // Return appropriate template or default
            return taskTemplates[projectType] || [
                'Assess project requirements and prepare site',
                'Remove or prepare existing elements',
                'Install new components per specifications',
                'Test and adjust all installations',
                'Complete finishing touches and clean site'
            ];
        }

        function getDefaultExclusions(projectType) {
            const exclusionTemplates = {
                'Kitchen Installation': ['Painting/decorating', 'Appliance installation', 'Disposal of old materials', 'Plumbing modifications'],
                'Bathroom Renovation': ['Painting/decorating', 'Disposal of old fixtures', 'Structural modifications', 'Electrical rewiring'],
                'Plastering': ['Painting/decorating', 'Structural repairs', 'Electrical work', 'Disposal of old plaster'],
                'Flooring': ['Furniture removal', 'Subfloor repairs', 'Painting/decorating', 'Disposal of old flooring'],
                'Carpentry': ['Painting/finishing', 'Hardware/fixtures', 'Structural modifications', 'Disposal of old materials'],
                'Decking': ['Ground excavation', 'Drainage work', 'Painting/staining', 'Landscaping'],
                'Painting & Decorating': ['Wall repairs', 'Wallpaper removal', 'Furniture moving', 'Carpet protection'],
                'Electrical Work': ['Structural modifications', 'Decorating/plastering', 'Consumer unit replacement', 'Full rewiring'],
                'Plumbing': ['Structural modifications', 'Decorating/tiling', 'Appliance installation', 'Drainage work'],
                'General Renovation': ['Painting/decorating', 'Permits/inspections', 'Structural modifications', 'Disposal costs']
            };
            
            return exclusionTemplates[projectType] || ['Painting/decorating', 'Disposal of materials', 'Structural modifications', 'Permits/inspections'];
        }

        function showFinalThankYou() {
            document.getElementById('thankYouOverlay').style.display = 'flex';
        }

        function closeThankYou() {
            document.getElementById('thankYouOverlay').style.display = 'none';
            document.getElementById('confirmationScreen').style.display = 'none';
            document.getElementById('initialForm').style.display = 'block';
            document.getElementById('consultationForm').reset();
            document.getElementById('client_materials_group').style.display = 'none';
            document.getElementById('client_materials_list').required = false;
            document.getElementById('projectStartSection').classList.add('hidden');
            document.getElementById('workDetailsSection').classList.add('hidden');
            formData = {};
        }

        populateFieldsFromURL();
    </script>
</body>
</html>
